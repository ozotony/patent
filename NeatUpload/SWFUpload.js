
var SWFUpload=function(init_settings){try{document.execCommand('BackgroundImageCache',false,true);}catch(ex){debugMessage(ex);}
try{settings={};movieName="SWFUpload_"+SWFUpload.movieCount++;movieElement=null;SWFUpload.instances[movieName]=this;initSettings(init_settings);loadFlash();if(debug_enabled){displayDebugInfo();}}catch(ex){debugMessage(ex);}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.ERROR_CODE_HTTP_ERROR=-10;SWFUpload.ERROR_CODE_MISSING_UPLOAD_TARGET=-20;SWFUpload.ERROR_CODE_IO_ERROR=-30;SWFUpload.ERROR_CODE_SECURITY_ERROR=-40;SWFUpload.ERROR_CODE_FILE_EXCEEDS_SIZE_LIMIT=-50;SWFUpload.ERROR_CODE_ZERO_BYTE_FILE=-60;SWFUpload.ERROR_CODE_UPLOAD_LIMIT_EXCEEDED=-70;SWFUpload.ERROR_CODE_UPLOAD_FAILED=-80;SWFUpload.ERROR_CODE_QUEUE_LIMIT_EXCEEDED=-90;SWFUpload.ERROR_CODE_SPECIFIED_FILE_NOT_FOUND=-100;SWFUpload.prototype.initSettings=function(init_settings){addSetting("control_id",movieName,"");addSetting("ui_function",init_settings.ui_function,null);addSetting("ui_container_id",init_settings.ui_container_id,"");addSetting("degraded_container_id",init_settings.degraded_container_id,"");addSetting("upload_target_url",init_settings.upload_target_url,"");addSetting("upload_cookies",init_settings.upload_cookies,[]);addSetting("upload_params",init_settings.upload_params,{});addSetting("begin_upload_on_queue",init_settings.begin_upload_on_queue,true);addSetting("file_types",init_settings.file_types,"*.gif;*.jpg;*.png");addSetting("file_types_description",init_settings.file_types_description,"Common Web Image Formats (gif, jpg, png)");addSetting("file_size_limit",init_settings.file_size_limit,"1024");addSetting("file_upload_limit",init_settings.file_upload_limit,"0");addSetting("file_queue_limit",init_settings.file_queue_limit,"0");addSetting("flash_url",init_settings.flash_url,"swfupload.swf");addSetting("flash_container_id",init_settings.flash_container_id,"");addSetting("flash_width",init_settings.flash_width,"1px");addSetting("flash_height",init_settings.flash_height,"1px");addSetting("flash_color",init_settings.flash_color,"#FFFFFF");addSetting("debug_enabled",init_settings.debug,false);debug_enabled=getSetting("debug_enabled");flashReady=retrieveSetting(init_settings.flash_ready_handler,flashReady);dialogCancelled=retrieveSetting(init_settings.dialog_cancelled_handler,dialogCancelled);fileQueued=retrieveSetting(init_settings.file_queued_handler,fileQueued);fileProgress=retrieveSetting(init_settings.file_progress_handler,fileProgress);fileCancelled=retrieveSetting(init_settings.file_cancelled_handler,fileCancelled);fileComplete=retrieveSetting(init_settings.file_complete_handler,fileComplete);queueStopped=retrieveSetting(init_settings.queue_stopped_handler,queueStopped);queueComplete=retrieveSetting(init_settings.queue_complete_handler,queueComplete);error=retrieveSetting(init_settings.error_handler,error);debug=retrieveSetting(init_settings.debug_handler,debug);};SWFUpload.prototype.loadFlash=function(){var html,container,target_element,flash_container_id;html=getFlashHTML();container=document.createElement("div");container.style.width=getSetting("flash_width");container.style.height=getSetting("flash_height");flash_container_id=getSetting("flash_container_id");if(flash_container_id!==""){target_element=document.getElementById(flash_container_id);}
if(typeof(target_element)==="undefined"||target_element===null){target_element=document.getElementsByTagName("body")[0];}
if(typeof(target_element)==="undefined"||target_element===null){debugMessage("Could not find an element to add the Flash too. Failed to find element for \"flash_container_id\" or the BODY element.");return false;}
target_element.appendChild(container);container.innerHTML=html;movieElement=document.getElementById(movieName);if(typeof(window[movieName])==="undefined"||window[movieName]!==movieElement){window[movieName]=movieElement;}};SWFUpload.prototype.getFlashHTML=function(){var html="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){html='<embed type="application/x-shockwave-flash" src="'+getSetting("flash_url")+'" width="'+getSetting("flash_width")+'" height="'+getSetting("flash_height")+'"';html+=' id="'+movieName+'" name="'+movieName+'" ';html+=' allowScriptAccess="always" ';html+='bgcolor="'+getSetting("flash_color")+'" quality="high" menu="false" flashvars="';html+=getFlashVars();html+='" />';}else{html='<object id="'+movieName+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+getSetting("flash_width")+'" height="'+getSetting("flash_height")+'">';html+='<param name="movie" value="'+getSetting("flash_url")+'">';html+='<param name="bgcolor" value="'+getSetting("flash_color")+'" />';html+='<param name="quality" value="high" />';html+='<param name="menu" value="false" />';html+='<param name="wmode" value="transparent" />';html+='<param name="allowScriptAccess" value="always" />';html+='<param name="flashvars" value="';html+=getFlashVars();html+='" /></object>';}
return html;};SWFUpload.prototype.getFlashVars=function(){var upload_target_url=getSetting("upload_target_url");var query_string=buildQueryString();var html="";html+="controlID="+encodeURIComponent(getSetting("control_id"));html+="&uploadTargetURL="+encodeURIComponent(upload_target_url);html+="&uploadQueryString="+encodeURIComponent(query_string);html+="&beginUploadOnQueue="+encodeURIComponent(getSetting("begin_upload_on_queue"));html+="&fileTypes="+encodeURIComponent(getSetting("file_types"));html+="&fileTypesDescription="+encodeURIComponent(getSetting("file_types_description"));html+="&fileSizeLimit="+encodeURIComponent(getSetting("file_size_limit"));html+="&fileUploadLimit="+encodeURIComponent(getSetting("file_upload_limit"));html+="&fileQueueLimit="+encodeURIComponent(getSetting("file_queue_limit"));html+="&debugEnabled="+encodeURIComponent(getSetting("debug_enabled"));return html;};SWFUpload.prototype.buildQueryString=function(){var upload_cookies=getSetting("upload_cookies");var upload_params=getSetting("upload_params");var query_string_pairs=[];var i,value,name;if(typeof(upload_cookies)==="object"&&typeof(upload_cookies.length)==="number"){for(i=0;i<upload_cookies.length;i++){if(typeof(upload_cookies[i])==="string"&&upload_cookies[i]!==""){value=getCookie(upload_cookies[i]);if(value!==""){query_string_pairs.push(encodeURIComponent(upload_cookies[i])+"="+encodeURIComponent(value));}}}}
if(typeof(upload_params)==="object"){for(name in upload_params){if(upload_params.hasOwnProperty(name)){if(typeof(upload_params[name])==="string"){query_string_pairs.push(encodeURIComponent(name)+"="+encodeURIComponent(upload_params[name]));}}}}
return query_string_pairs.join("&");};SWFUpload.prototype.showUI=function(){var ui_container_id,ui_target,degraded_container_id,degraded_target;try{ui_container_id=getSetting("ui_container_id");if(ui_container_id!==""){ui_target=document.getElementById(ui_container_id);if(ui_target!==null){ui_target.style.display="block";degraded_container_id=getSetting("degraded_container_id");if(degraded_container_id!==""){degraded_target=document.getElementById(degraded_container_id);if(degraded_target!==null){degraded_target.style.display="none";}}}}}catch(ex){debugMessage(ex);}};SWFUpload.prototype.addSetting=function(name,value,default_value){if(typeof(value)==="undefined"||value===null){settings[name]=default_value;}else{settings[name]=value;}
return settings[name];};SWFUpload.prototype.getSetting=function(name){if(typeof(settings[name])==="undefined"){return"";}else{return settings[name];}};SWFUpload.prototype.retrieveSetting=function(value,default_value){if(typeof(value)==="undefined"||value===null){return default_value;}else{return value;}};SWFUpload.prototype.displayDebugInfo=function(){var key,debug_message="";debug_message+="----- DEBUG OUTPUT ----\nID: "+movieElement.id+"\n";for(key in settings){if(settings.hasOwnProperty(key)){debug_message+=key+": "+settings[key]+"\n";}}
debug_message+="----- DEBUG OUTPUT END ----\n";debug_message+="\n";debugMessage(debug_message);};SWFUpload.prototype.setUploadTargetURL=function(url){if(typeof(url)==="string"){return addSetting("upload_target_url",url,"");}else{return false;}};SWFUpload.prototype.setUploadCookies=function(cookie_name_array){if(typeof(cookie_name_array)==="object"&&typeof(cookie_name_array.length)==="number"){return addSetting("upload_cookies",cookie_name_array,[]);}else{return false;}};SWFUpload.prototype.setUploadParams=function(param_object){if(typeof(param_object)==="object"){return addSetting("upload_params",param_object,[]);}else{return false;}};SWFUpload.prototype.browse=function(){if(typeof(movieElement)!=="undefined"&&typeof(movieElement.Browse)==="function"){try{movieElement.Browse();}
catch(ex){debugMessage("Could not call browse: "+ex);}}else{debugMessage("Could not find Flash element");}};SWFUpload.prototype.startUpload=function(file_id){if(typeof(movieElement)!=="undefined"&&typeof(movieElement.StartUpload)==="function"){try{movieElement.StartUpload(file_id);}
catch(ex){debugMessage("Could not call StartUpload: "+ex);}}else{debugMessage("Could not find Flash element");}};SWFUpload.prototype.cancelUpload=function(file_id){if(typeof(movieElement)!=="undefined"&&typeof(movieElement.CancelUpload)==="function"){try{movieElement.CancelUpload(file_id);}
catch(ex){debugMessage("Could not call CancelUpload");}}else{debugMessage("Could not find Flash element");}};SWFUpload.prototype.cancelQueue=function(){if(typeof(movieElement)!=="undefined"&&typeof(movieElement.CancelQueue)==="function"){try{movieElement.CancelQueue();}
catch(ex){debugMessage("Could not call CancelQueue");}}else{debugMessage("Could not find Flash element");}};SWFUpload.prototype.stopUpload=function(){if(typeof(movieElement)!=="undefined"&&typeof(movieElement.StopUpload)==="function"){try{movieElement.StopUpload();}
catch(ex){debugMessage("Could not call StopUpload");}}else{debugMessage("Could not find Flash element");}};SWFUpload.prototype.updateUploadStrings=function(){if(typeof(movieElement)!=="undefined"&&typeof(movieElement.SetUploadStrings)==="function"){try{movieElement.SetUploadStrings(getSetting("upload_target_url"),buildQueryString());}
catch(ex){debugMessage("Could not call SetUploadStrings");}}else{debugMessage("Could not find Flash element");}};SWFUpload.prototype.addFileParam=function(file_id,name,value){if(typeof(movieElement)!=="undefined"&&typeof(movieElement.AddFileParam)==="function"){try{return movieElement.AddFileParam(file_id,encodeURIComponent(name),encodeURIComponent(value));}
catch(ex){debugMessage("Could not call addFileParam");}}else{debugMessage("Could not find Flash element");}};SWFUpload.prototype.removeFileParam=function(file_id,name){if(typeof(movieElement)!=="undefined"&&typeof(movieElement.RemoveFileParam)==="function"){try{return movieElement.RemoveFileParam(file_id,encodeURIComponent(name));}
catch(ex){debugMessage("Could not call addFileParam");}}else{debugMessage("Could not find Flash element");}};SWFUpload.prototype.flashReady=function(){var ui_function;try{debugMessage("Flash called back and is ready.");ui_function=getSetting("ui_function");if(typeof(ui_function)==="function"){ui_function.apply(this);}else{showUI();}}catch(ex){debugMessage(ex);}};SWFUpload.prototype.dialogCancelled=function(){debugMessage("browse Dialog Cancelled.");};SWFUpload.prototype.fileQueued=function(file){debugMessage("File Queued: "+file.id);};SWFUpload.prototype.fileProgress=function(file,bytes_complete){debugMessage("File Progress: "+file.id+", Bytes: "+bytes_complete);};SWFUpload.prototype.fileCancelled=function(file){debugMessage("File Cancelled: "+file.id);};SWFUpload.prototype.fileComplete=function(file){debugMessage("File Complete: "+file.id);};SWFUpload.prototype.queueComplete=function(file_upload_count){debugMessage("Queue Complete. Files Uploaded:"+file_upload_count);};SWFUpload.prototype.queueStopped=function(file){debugMessage("Queue Stopped. File Stopped:"+file.id);};SWFUpload.prototype.debug=function(message){debugMessage(message);};SWFUpload.prototype.error=function(errcode,file,msg){try{switch(errcode){case SWFUpload.ERROR_CODE_HTTP_ERROR:debugMessage("Error Code: HTTP Error, File name: "+file.name+", Message: "+msg);break;case SWFUpload.ERROR_CODE_MISSING_UPLOAD_TARGET:debugMessage("Error Code: No backend file, File name: "+file.name+", Message: "+msg);break;case SWFUpload.ERROR_CODE_IO_ERROR:debugMessage("Error Code: IO Error, File name: "+file.name+", Message: "+msg);break;case SWFUpload.ERROR_CODE_SECURITY_ERROR:debugMessage("Error Code: Security Error, File name: "+file.name+", Message: "+msg);break;case SWFUpload.ERROR_CODE_FILE_EXCEEDS_SIZE_LIMIT:debugMessage("Error Code: File too big, File name: "+file.name+", File size: "+file.size+", Message: "+msg);break;case SWFUpload.ERROR_CODE_ZERO_BYTE_FILE:debugMessage("Error Code: Zero Byte File, File name: "+file.name+", File size: "+file.size+", Message: "+msg);break;case SWFUpload.ERROR_CODE_UPLOAD_LIMIT_EXCEEDED:debugMessage("Error Code: Upload limit reached, File name: "+file.name+", File size: "+file.size+", Message: "+msg);break;case SWFUpload.ERROR_CODE_QUEUE_LIMIT_EXCEEDED:debugMessage("Error Code: Upload limit reached, File name: "+file.name+", File size: "+file.size+", Message: "+msg);break;case SWFUpload.ERROR_CODE_UPLOAD_FAILED:debugMessage("Error Code: Upload Initialization exception, File name: "+file.name+", File size: "+file.size+", Message: "+msg);break;case SWFUpload.ERROR_CODE_SPECIFIED_FILE_NOT_FOUND:debugMessage("Error Code: File ID specified for upload was not found, Message: "+msg);break;default:debugMessage("Error Code: Unhandled error occured. Errorcode: "+errcode);}}catch(ex){debugMessage(ex);}};SWFUpload.prototype.getCookie=function(cookie_name){var cookie_start,cookie_end;try{if(document.cookie.length>0&&cookie_name!=="")
{cookie_start=document.cookie.indexOf(cookie_name+"=");if(cookie_start!==-1)
{cookie_start=cookie_start+cookie_name.length+1;cookie_end=document.cookie.indexOf(";",cookie_start);if(cookie_end===-1){cookie_end=document.cookie.length;}
return unescape(document.cookie.substring(cookie_start,cookie_end));}}}catch(ex){debugMessage(ex);}
return"";};SWFUpload.prototype.debugMessage=function(message){var exception_message,exception_values;if(debug_enabled){if(typeof(message)==="object"&&typeof(message.name)==="string"&&typeof(message.message)==="string"){exception_message="";exception_values=[];for(var key in message){exception_values.push(key+": "+message[key]);}
exception_message=exception_values.join("\n");exception_values=exception_message.split("\n");exception_message="EXCEPTION: "+exception_values.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(exception_message);}else{SWFUpload.Console.writeLine(message);}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(message){var console,documentForm;try{console=document.getElementById("SWFUpload_Console");if(!console){documentForm=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(documentForm);console=document.createElement("textarea");console.id="SWFUpload_Console";console.style.fontFamily="monospace";console.setAttribute("wrap","off");console.wrap="off";console.style.overflow="auto";console.style.width="700px";console.style.height="350px";console.style.margin="5px";documentForm.appendChild(console);}
console.value+=message+"\n";console.scrollTop=console.scrollHeight-console.clientHeight;}catch(ex){alert("Exception: "+ex.name+" Message: "+ex.message);}};